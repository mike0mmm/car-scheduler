<% include ../partials/header %>
<% include ../partials/navbar %>

<div class="container-fluid">
    <% if (vendors.length > 0) { %>
        <div class="row align-items-center justify-content-center mt-3">
            <div id="open-form-dialog" class="btn btn-primary btn-round">
              יצירת רשומת נסיעה חדשה
            </div>
        </div>
        <div id="form-dialog" class="col-10 col-lg-8 container mt-2 bg-light" style="padding: 1.5rem;">
            <form action="/company/<%= user.company._id %>/rides" method="POST" class="">
                <div class="row card2 card-body2 bg-light9">
                    
                    <div class="col-md-6 col-12 left-line">
                            <div class="form-group">
                                <label for="name">
                                    שם נסיעה
                                </label>
                                <input type="text" class="form-control" name="name" placeholder="שם נסיעה">
                                <label for="rideID">
                                    תג זיהוי נסיעה
                                </label>
                                <input type="number" readonly="readonly" class="form-control" name="rideID" value="<%= rideID %>">
                                <label for="personInfo">
                                    שם איש קשר
                                </label>
                                <input type="text" class="form-control" name="personInfo" placeholder=" שם איש קשר">
                                <label for="phoneNumber">
                                    טלפון איש קשר
                                </label>
                                <input class="form-control input-phone" name="phoneNumber" placeholder="0XX-XXX-XXXX">
                                <label for="rideType">
                                    סוג נסיעה
                                </label>
                                <select id="rideType" name="rideType" class="form-control">
                                    <option disabled selected value>
                                        בחר סוג נסיעה
                                    </option>
                                    <option value="regular">
                                        נסיעה קבוע
                                    </option>
                                    <option value="onetime">
                                       נסיעה חד פעמית
                                    </option>
                                </select>
                                
                                <div id="regular-ride-form" class="container" style="display: none;">
                                    <label for="rideStartDate">
                                        תאריך תחילת הנסיעה
                                    </label>
                                    <input class="form-control input-date" id="startDate" name="rideStartDate" novalidate placeholder="09/09/2018">
                                    <label for="rideEndDate">
                                        תאריך סיום הנסיעה
                                    </label>
                                    <input class="form-control input-date" id="endDate" name="rideEndDate" novalidate placeholder="09/09/2019">
                                    <label for="rideType">
                                        בחר ימי שבוע לנסיע
                                    </label>
                                    <div class="form-control height-auto">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[0]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[1]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[2]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[3]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[4]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[5]" id="inlineCheckbox1" value="0">
                                        <input class="form-check-input" type="hidden" name="dayOfWeek[6]" id="inlineCheckbox1" value="0">
                                        
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[0]" id="inlineCheckbox1" value="1">
                                          <label class="form-check-label" for="inlineCheckbox1">ראשון</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[1]" id="inlineCheckbox2" value="1">
                                          <label class="form-check-label" for="inlineCheckbox2">שני</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[2]" id="inlineCheckbox3" value="1">
                                          <label class="form-check-label" for="inlineCheckbox3">שלישי</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[3]" id="inlineCheckbox1" value="1">
                                          <label class="form-check-label" for="inlineCheckbox1">רביעי</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[4]" id="inlineCheckbox2" value="1">
                                          <label class="form-check-label" for="inlineCheckbox2">חמישי</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[5]" id="inlineCheckbox3" value="1">
                                          <label class="form-check-label" for="inlineCheckbox3">שישי</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                          <input class="form-check-input" type="checkbox" name="dayOfWeek[6]" id="inlineCheckbox3" value="1">
                                          <label class="form-check-label" for="inlineCheckbox3">שבת</label>
                                        </div>
                                    </div>
                                    <label for="startTime">
                                        שעת תחילת הנסיעה
                                    </label>
                                    <input class="form-control input-time" id="time-form" name="startTime" placeholder="12:00">
                                    <label for="endTime">
                                        שעת סיום הנסיעה
                                    </label>
                                    <input class="form-control input-time" id="time-form" name="endTime" placeholder="13:30">
                                </div>
                                
                                <div id="onetime-ride-form" class="container" style="display: none;">
                                    <label for="rideStartDate">
                                        תאריך הנסיעה
                                    </label>
                                    <input class="form-control input-date" id="startDate" name="rideStartDate" placeholder="09/09/2018">
                                    <label for="startTime">
                                        שעת תחילת הנסיעה
                                    </label>
                                    <input class="form-control input-time" id="time-form" name="startTime" placeholder="12:00">
                                    <label for="endTime">
                                        שעת סיום הנסיעה
                                    </label>
                                    <input class="form-control input-time" id="time-form" name="endTime" placeholder="13:30">
                                </div>
                                
                                
                                <label for="vendor">
                                    ספק
                                </label>
                                <select id="vendor" name="vendor" class="form-control">
                                    <% vendors.forEach(function(vendor){ %>
                                        <option value="<%= vendor._id %>">
                                            <%= vendor.name %>
                                        </option>
                                    <% }) %>
                                </select>
                                <label for="priceBeforeVAT">
                                    מחיר נסיעה (לפני מע"מ)
                                </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">₪</div>
                                    </div>
                                    <input class="form-control input-price" id="priceBeforeVAT" name="priceBeforeVAT" placeholder="100">
                                </div>
                                <label for="priceBeforeVAT">
                                    מחיר נסיעה (כולל מע"מ)
                                </label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">₪</div>
                                    </div>
                                    <input class="form-control input-price" id="priceAfterVAT" name="priceAfterVAT">
                                </div>
                               
                            </div>
                    </div>
                    <div class="col-md-6 col-12">
                        <a href="javascript:void(0)" id="addStop" class="btn btn-default btn-round btn-sm btn-block mt-2 mb-4">
                            הוסף כתובת איסוף
                        </a>
                        <div id="stops">
                                    
                        </div>
                    </div>
                    
                </div>
                <button type="submit" class="btn btn-primary btn-round btn-block mt-4">
                    שלח
                </button>
            </form>    
        </div>
    
        <% if (rides && rides.length != 0) { %>
            <div class="row mt-3 align-items-center justify-content-center">
                <div class="col-11 col-lg-8">
                    <div class="form-inline">
                        <!--<div class="input-group-prepend">-->
                        <!--    <div class="input-group-text">-->
                        <!--        <i class="fal fa-search"></i>-->
                        <!--    </div>-->
                        <!--</div>-->
                         <select id="search-type" class="form-control col-5 col-md-3" style="height: 40px;">
                            <option value="ride-name" selected>
                              שם נסיעה
                            </option>
                            <option value="ride-vendor">
                              שם ספק
                            </option>
                        </select>
                        <input class="form-control col-7 col-md-9" id="searchInput" placeholder="הכנס מילות חיפוש">
                       
                    </div>
                    
                </div>
            </div>
            <div class="mt-3">
                <% rides.forEach(function(ride) { %>
                    <a href="rides/<%= ride._id %>">
                        <div class="row mb-1 card-body bg-light ride-card align-items-start justify-content-center">
                            <div class="col-1">
                                <small class="ride-id"><%= ride.rideID %></small>
                            </div>
                            <div class="col-3 col-sm-3 col-lg-2">
                                <span class="ride-name">
                                    <%= ride.name %>
                                </span>
                                <br>
                                <small>
                                    <% if(ride.rideType == 'onetime') { %>
                                        נסיעה חד פעמית
                                    <% } else { %>
                                        נסיעה קבוע
                                    <% } %>
                                </small>
                            </div>
                            <div class="col-3 d-none d-lg-block">
                                <% if (ride.rideType == 'onetime') { %>
                                    <small class="ride-startDate">
                                    <%= ride.rideStartDate %>
                                    <br>
                                        <%= ride.startTime %> - <%= ride.endTime %>
                                    </small>
                                <% } else { %>
                                    <small class="ride-startDate">
                                    <%= ride.rideStartDate %> - <%= ride.rideEndDate %>
                                    <br>
                                        <%= ride.startTime %> - <%= ride.endTime %>
                                    </small>
                                <% } %>
                            </div>
                            <div class="col-4 col-sm-4 col-lg-2">
                                    <small>
                                    <span class="ride-vendor"><%= ride.vendor.name %></span>
                                    <br>
                                    
                                        איש קשר - 
                                        <%= ride.personInfo %> - <div style="direction: ltr;"><%= ride.phoneNumber %></div>
                                    </small>
                            </div>
                            <div class="col-2 d-none d-lg-block">
                                    <% if(ride.addresses.length == 1) { %>
                                        תחנה אחד
                                    <% } else { %>
                                        מספר תחנות - 
                                        <%= ride.addresses.length %>
                                    <% } %>
                                    <br>
                                    <small>
                                        סה"כ נוסעים - 
                                        <%= ride.numberOfPassengers %>
                                    </small>
                            </div>
                            <div class="col-3 col-sm-3 col-lg-2">
                                    <small> 
                                    מחיר לפני מע"מ:
                                    <br>
                                    <%= ride.priceBeforeVAT %> ₪ 
                                    </small>
                            </div>
                        </div>
                    </a>
                <% }); %>
            </div>
        
        <% } else { %>
        
            <div class="row justify-content-md-center">
                <div class="mx-auto mt-3  card card-body bg-light col-8 text-center">
                    נראה שלא נוספו נסיעות עדיין. הוסף נסיעה.
                </div>
            </div>
            
        <% } %>
    <% } else { %>
    <div class="row justify-content-md-center mt-5">
        <div class="mx-auto mt-3 card card-body bg-light col-8 text-center">
            נראה שלא נוספו או הופעלו ספקים. לא ניתן להוסיף נסיעה לפני הוספה או הפעלה של ספק.
        </div>
    </div>
    <% } %>
</div>



<% include ../partials/footer %>
<script type="text/javascript" src="/assets/js/rides-creation.js"></script>
<script type="text/javascript" src="/assets/js/ride-livesearch.js"></script>
<% include ../partials/closing_tags %>
